(window.webpackJsonp=window.webpackJsonp||[]).push([[4],{404:function(t,e,i){},405:function(t,e,i){},406:function(t,e,i){},417:function(t,e,i){},420:function(t,e,i){},438:function(t,e,i){},439:function(t,e,i){},532:function(t,e,i){"use strict";i(404)},533:function(t,e,i){"use strict";i(405)},534:function(t,e,i){"use strict";i(406)},585:function(t,e,i){"use strict";i(417)},586:function(t,e,i){},591:function(t,e,i){"use strict";i(420)},596:function(t,e,i){"use strict";i(438)},597:function(t,e,i){"use strict";i(439)},616:function(t,e,i){"use strict";i.r(e),i.d(e,"DocEditor",(function(){return vt}));var n,r=i(403),o=i(357),c=i(35),a=(i(9),i(11),i(12),i(94),i(337),i(622)),u=i(623),s=i(613),l=i(349),d={props:{icon:{type:String,required:!0},title:{type:String,required:!0},action:{type:Function,required:!0},isActive:{type:[Function,Boolean],default:null}}},f=(i(532),i(25)),v={components:{MenuItem:Object(f.a)(d,(function(){var t=this.$createElement,e=this._self._c||t;return e("button",{staticClass:"menu-item",class:{"is-active":this.isActive?this.isActive():null},attrs:{title:this.title},on:{click:this.action}},[e("i",{class:"ri-"+this.icon})])}),[],!1,null,"6a946892",null).exports},props:{editor:{type:Object,required:!0}},data:function(){var t=this;return{items:[{icon:"arrow-go-back-line",title:"撤销",action:function(){return t.editor.chain().focus().undo().run()}},{icon:"arrow-go-forward-line",title:"重做",action:function(){return t.editor.chain().focus().redo().run()}},{icon:"bold",title:"加粗",action:function(){return t.editor.chain().focus().toggleBold().run()},isActive:function(){return t.editor.isActive("bold")}},{icon:"underline",title:"下划线",action:function(){return t.editor.chain().focus().toggleUnderline().run()},isActive:function(){return t.editor.isActive("underline")}},{icon:"italic",title:"斜体",action:function(){return t.editor.chain().focus().toggleItalic().run()},isActive:function(){return t.editor.isActive("italic")}},{icon:"strikethrough",title:"删除线",action:function(){return t.editor.chain().focus().toggleStrike().run()},isActive:function(){return t.editor.isActive("strike")}},{icon:"code-view",title:"代码块",action:function(){return t.editor.chain().focus().toggleCode().run()},isActive:function(){return t.editor.isActive("code")}},{icon:"mark-pen-line",title:"高亮",action:function(){return t.editor.chain().focus().toggleHighlight().run()},isActive:function(){return t.editor.isActive("highlight")}},{icon:"align-left",title:"左对齐",action:function(){return t.editor.chain().focus().setTextAlign("left").run()},isActive:function(){return t.editor.isActive({textAlign:"left"})}},{icon:"align-center",title:"居中",action:function(){return t.editor.chain().focus().setTextAlign("center").run()},isActive:function(){return t.editor.isActive({textAlign:"center"})}},{icon:"align-right",title:"右对齐",action:function(){return t.editor.chain().focus().setTextAlign("right").run()},isActive:function(){return t.editor.isActive({textAlign:"right"})}},{icon:"align-justify",title:"两端对其",action:function(){return t.editor.chain().focus().setTextAlign("justify").run()},isActive:function(){return t.editor.isActive({textAlign:"justify"})}},{icon:"h-1",title:"一级标题",action:function(){return t.editor.chain().focus().toggleHeading({level:1}).run()},isActive:function(){return t.editor.isActive("heading",{level:1})}},{icon:"h-2",title:"二级标题",action:function(){return t.editor.chain().focus().toggleHeading({level:2}).run()},isActive:function(){return t.editor.isActive("heading",{level:2})}},{icon:"h-3",title:"三级标题",action:function(){return t.editor.chain().focus().toggleHeading({level:3}).run()},isActive:function(){return t.editor.isActive("heading",{level:3})}},{icon:"h-4",title:"四级标题",action:function(){return t.editor.chain().focus().toggleHeading({level:4}).run()},isActive:function(){return t.editor.isActive("heading",{level:4})}},{icon:"h-5",title:"五级标题",action:function(){return t.editor.chain().focus().toggleHeading({level:5}).run()},isActive:function(){return t.editor.isActive("heading",{level:5})}},{icon:"h-6",title:"六级标题",action:function(){return t.editor.chain().focus().toggleHeading({level:6}).run()},isActive:function(){return t.editor.isActive("heading",{level:6})}},{icon:"paragraph",title:"段落",action:function(){return t.editor.chain().focus().setParagraph().run()},isActive:function(){return t.editor.isActive("paragraph")}},{icon:"list-unordered",title:"无需列表",action:function(){return t.editor.chain().focus().toggleBulletList().run()},isActive:function(){return t.editor.isActive("bulletList")}},{icon:"list-ordered",title:"有序列表",action:function(){return t.editor.chain().focus().toggleOrderedList().run()},isActive:function(){return t.editor.isActive("orderedList")}},{icon:"list-check-2",title:"任务列表",action:function(){return t.editor.chain().focus().toggleTaskList().run()},isActive:function(){return t.editor.isActive("taskList")}},{icon:"code-box-line",title:"代码",action:function(){return t.editor.chain().focus().toggleCodeBlock().run()},isActive:function(){return t.editor.isActive("codeBlock")}},{icon:"table-2",title:"表格",action:function(){return t.editor.chain().focus().insertTable({rows:3,cols:3,withHeaderRow:!0}).run()},isActive:!1},{icon:"image-line",title:"图片",action:function(){var e=window.prompt("URL");e&&t.editor.chain().focus().setImage({src:e}).run()},isActive:!1},{icon:"links-fill",title:"A标签",action:function(){if(t.editor.isActive("link"))t.editor.chain().focus().unsetLink().run();else{var e=window.prompt("URL");t.editor.chain().focus().extendMarkRange("link").setLink({href:e}).run()}},isActive:function(){return t.editor.isActive("link")}},{icon:"draft-line",title:"签名",action:function(){t.editor.commands.insertContent('<drawing data-type="drawing"></drawing><br/>')},isActive:!1},{icon:"double-quotes-l",title:"引用",action:function(){return t.editor.chain().focus().toggleBlockquote().run()},isActive:function(){return t.editor.isActive("blockquote")}},{icon:"separator",title:"分割线",action:function(){return t.editor.chain().focus().setHorizontalRule().run()}},{icon:"text-wrap",title:"换行",action:function(){return t.editor.chain().focus().setHardBreak().run()}},{icon:"format-clear",title:"清理格式",action:function(){return t.editor.chain().focus().clearNodes().unsetAllMarks().run()}}]}}},p=(i(533),Object(f.a)(v,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",[t._l(t.items,(function(e,n){return["divider"===e.type?i("div",{key:n,staticClass:"divider"}):i("menu-item",t._b({key:n},"menu-item",e,!1))]}))],2)}),[],!1,null,"164195bc",null).exports),g=(i(72),{props:{icon:{type:String,required:!0},title:{type:String,required:!0},action:{type:Function,required:!0},isActive:{type:[Function,Boolean],default:null}}}),h=(i(534),Object(f.a)(g,(function(){var t=this.$createElement,e=this._self._c||t;return e("button",{staticClass:"menu-item",class:{"is-active":this.isActive?this.isActive():null},attrs:{title:this.title},on:{click:this.action}},[e("i",{class:"ri-"+this.icon})])}),[],!1,null,"a51918c0",null).exports),b=i(535),m={components:(n={MenuItem:h},Object(o.a)(n,b.Dialog.name,b.Dialog),Object(o.a)(n,b.Button.name,b.Button),n),props:{editor:{type:Object,required:!0}},data:function(){var t=this;return{dialogFormVisible:!1,marks:[],items:[{icon:"add-fill",title:"添加标记",isActive:function(){return!0},action:function(){return t.dialogFormVisible=!0}}]}}},w=(i(585),Object(f.a)(m,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",[t._l(t.items,(function(e,n){return["divider"===e.type?i("div",{key:n,staticClass:"divider"}):i("menu-item",t._b({key:n},"menu-item",e,!1))]})),t._v(" "),i("el-dialog",{attrs:{title:"添加标记",visible:t.dialogFormVisible,width:"30%"},on:{"update:visible":function(e){t.dialogFormVisible=e}}},[i("div",{staticStyle:{width:"300px"}}),t._v(" "),i("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{attrs:{size:"mini"},on:{click:function(e){t.dialogFormVisible=!1}}},[t._v("取 消")]),t._v(" "),i("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(e){t.dialogFormVisible=!1}}},[t._v("确 定")])],1)])],2)}),[],!1,null,"0977c3d2",null).exports),A=(i(586),i(312)),y=A.c.create({name:"readdisable",defaultOptions:{HTMLAttributes:{id:null}},addAttributes:function(){return{id:null}},priority:1e3,parseHTML:function(){return[{tag:"readdisable"}]},renderHTML:function(t){var e=t.HTMLAttributes;return["readdisable",Object(A.m)(this.options.HTMLAttributes,e),0]},addCommands:function(t){return{toggleReadDisable:function(t){return function(e){var i=e.commands;return e.editor.isActive("readdisable")?i.unsetMark("readdisable"):i.setMark("readdisable",{id:t})}}}}}),k=A.c.create({name:"writedisable",defaultOptions:{HTMLAttributes:{contenteditable:!1,id:null}},priority:1e3,addAttributes:function(){return{id:null}},parseHTML:function(){return[{tag:"writedisable"}]},renderHTML:function(t){var e=t.HTMLAttributes;return["writedisable",Object(A.m)(this.options.HTMLAttributes,e),0]},addCommands:function(){return{toggleWriteDisable:function(t){return function(e){var i=e.commands,n=e.editor;e.tr;console.log(e);var r=n.isActive("writedisable");return console.log(r),r?i.unsetMark("writedisable"):i.setMark("writedisable",{id:t})}}}}}),M=A.c.create({name:"writeable",defaultOptions:{HTMLAttributes:{contenteditable:!0,id:null}},addAttributes:function(){return{id:null}},priority:1e3,parseHTML:function(){return[{tag:"writeable"}]},renderHTML:function(t){var e=t.HTMLAttributes;return["writeable",Object(A.m)(this.options.HTMLAttributes,e),0]},addCommands:function(t){return{toggleWriteAble:function(t){return function(e){var i=e.commands;return e.editor.isActive("writeable")?i.unsetMark("writeable"):i.setMark("writeable",{id:t})}}}}}),x=A.c.create({name:"underline",defaultOptions:{HTMLAttributes:{}},parseHTML:function(){return[{tag:"underline"}]},renderHTML:function(t){var e=t.HTMLAttributes;return["underline",Object(A.m)(this.options.HTMLAttributes,e),0]},addCommands:function(){return{toggleUnderline:function(){return function(t){return t.commands.toggleMark("underline")}}}}}),O=(i(70),i(26),i(587)),C=i(601),j=i(590),L=i.n(j),T={name:"Drawing",components:{NodeViewWrapper:l.c},props:{updateAttributes:{type:Function,required:!0},editor:{type:Object},node:{type:Object,required:!0}},data:function(){return{color:"#000",size:1,svg:null,path:null,points:[],drawing:!1,id:Object(O.v4)()}},methods:{onStartDrawing:function(t){this.drawing=!0,this.points=[],this.path=this.svg.append("path").data([this.points]).attr("id","id-".concat(this.id)).attr("stroke",this.color).attr("stroke-width",this.size);var e="mousedown"===t.type?"mousemove":"touchmove";this.svg.on(e,this.onMove)},onMove:function(t){t.preventDefault(),this.points.push(C.c(t)[0]),this.tick()},onEndDrawing:function(){this.svg.on("mousemove",null),this.svg.on("touchmove",null),this.drawing&&(this.drawing=!1,this.svg.select("#id-".concat(this.id)).remove(),this.id=Object(O.v4)())},simplifyPoints:function(t){return L()(t.map((function(t){return{x:t[0],y:t[1]}}))).map((function(t){return[t.x,t.y]}))},tick:function(){var t=this;requestAnimationFrame((function(){t.path.attr("d",(function(e){var i=C.b().curve(C.a)(e),n=t.node.attrs.lines.filter((function(e){return e.id!==t.id}));return t.updateAttributes({lines:[].concat(Object(c.a)(n),[{id:t.id,color:t.color,size:t.size,path:i}])}),i}))}))},clear:function(){this.updateAttributes({lines:[]})}},computed:{editable:function(t){return t.editor.options.editable},drawBox:function(t){return function(){return t.$refs.drawBox}},isFull:function(t){return function(t){var e;return"fixed"===(null==t||null===(e=t.style)||void 0===e?void 0:e.position)}},full:function(t){return function(t){t.style.position="fixed",t.style.top="0",t.style.left="0",t.style.width="100vw",t.style.height="100vh",t.style.background="#fff",t.style.zIndex="99999"}},disableFull:function(t){return function(t){t.style.position="",t.style.top="",t.style.left="",t.style.width="",t.style.height="",t.style.background="",t.style.zIndex=""}}},mounted:function(){this.svg=C.d(this.$refs.canvas),this.editable&&this.svg.on("mousedown",this.onStartDrawing).on("mouseup",this.onEndDrawing).on("mouseleave",this.onEndDrawing).on("touchstart",this.onStartDrawing).on("touchend",this.onEndDrawing).on("touchleave",this.onEndDrawing)}},H=(i(591),Object(f.a)(T,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("node-view-wrapper",{staticClass:"doc-draw"},[i("div",{ref:"drawBox",class:["draw-box"]},[t.editable?i("div",{staticClass:"doc-draw-set-box"},[i("button",{staticClass:"pionter",on:{click:t.clear}},[t._v("重新签名")]),t._v(" "),i("button",{staticClass:"pionter",on:{click:function(e){t.isFull(t.drawBox())?t.disableFull(t.drawBox()):t.full(t.drawBox())}}},[t._v("\n        切换全屏\n      ")])]):t._e(),t._v(" "),i("svg",{ref:"canvas",style:{cursor:t.editable?"crosshair":"pointer"},attrs:{viewBox:"0 0 500 250"}},[t._l(t.node.attrs.lines,(function(e){return[e.id!==t.id?i("path",{key:e.id,attrs:{d:e.path,id:"id-"+e.id,stroke:e.color,"stroke-width":e.size}}):t._e()]}))],2)])])}),[],!1,null,null,null).exports),_=A.d.create({name:"drawing",group:"block",atom:!0,addAttributes:function(){return{lines:{default:[]}}},parseHTML:function(){return[{tag:'drawing[data-type="drawing"]'}]},renderHTML:function(t){var e=t.HTMLAttributes;return["drawing",Object(A.m)(e,{"data-type":"drawing"})]},addNodeView:function(){return Object(l.d)(H)}}),B=i(314),D=i(607);A.b.create({addProseMirrorPlugins:function(){var t;return[new B.d({view:function(e){var i=document.createElement("div");return i.draggable="true",i.classList.add("global-drag-handle"),i.addEventListener("dragstart",(function(t){return function(t,e){if(e.composing=!0,t.dataTransfer){var i=function(t,e){var i=e.posAtCoords(t),n=e.domAtPos(i.pos);for(n=n.node;n&&n.parentNode;){var r,o;if(null!==(r=n.parentNode)&&void 0!==r&&null!==(o=r.classList)&&void 0!==o&&o.contains("ProseMirror"))break;n=n.parentNode}if(n&&1===n.nodeType){var c=e.docView.nearestDesc(n,!0);if(c&&c!==e.docView)return c.posBefore}return null}({left:t.clientX+50,top:t.clientY},e);if(null!=i){var n;e.dispatch(e.state.tr.setSelection(B.c.create(e.state.doc,i)));var r=e.state.selection.content(),o=Object(D.a)(e,r),c=o.dom,a=o.text;t.dataTransfer.clearData(),t.dataTransfer.setData("text/html",c.innerHTML),t.dataTransfer.setData("text/plain",a);var u=document.querySelector(".ProseMirror-selectednode");null===(n=t.dataTransfer)||void 0===n||n.setDragImage(u,0,0),e.dragging={slice:r,move:!0}}}}(t,e)})),t=i,document.body.appendChild(t),{destroy:function(){var e;(e=t).parentNode.removeChild(e),t=null}}},props:{handleDrop:function(t,e,i,n){},handleDOMEvents:{mousemove:function(e,i){var n={left:i.clientX+28+50,top:i.clientY},r=e.posAtCoords(n);if(r){var o=e.domAtPos(null==r?void 0:r.pos);if(o){for(o=o.node;o&&o.parentNode;){var c,a;if(null!==(c=o.parentNode)&&void 0!==c&&null!==(a=c.classList)&&void 0!==a&&a.contains("ProseMirror"))break;o=o.parentNode}if(o instanceof Element){var u=window.getComputedStyle(o),s=parseInt(u.lineHeight,10),l=function(t){var e=t.getBoundingClientRect();return{top:e.top,left:e.left,width:e.width}}(o),d=o.ownerDocument.defaultView;l.top+=d.pageYOffset+(s-24)/2+0,l.left+=d.pageXOffset,l.width="".concat(28,"px"),t.style.left="".concat(-28+l.left,"px"),t.style.top="".concat(l.top,"px")}}}}}}})]}});var F=i(446),S=i(447),E=i(427),U=i(428),q=i(429),N=i(430),P=i(377),z=i(431),I=i(432),V=i(378),$=i(433),R=i(449),W=i(435),J=i(436),X=i(437),Y=i(602),G=U.a.extend({addAttributes:function(){var t;return Object(r.a)(Object(r.a)({},null===(t=this.parent)||void 0===t?void 0:t.call(this)),{},{backgroundColor:{default:null,parseHTML:function(t){return{backgroundColor:t.getAttribute("data-background-color")}},renderHTML:function(t){return{"data-background-color":t.backgroundColor,style:"background-color: ".concat(t.backgroundColor)}}}})}}),K=[Y.a,F.a.configure({resizable:!0,allowTableNodeSelection:!0}),_,y,k,M,x,$.a,E.a,q.a,N.a,P.a,G,W.a,J.a,V.a,z.a.configure({types:["heading","paragraph"]}),X.a.configure({limit:1e4}),I.a],Q=i(321),Z=i(612),tt=i(617),et=i(603),it=i(628),nt=i(624),rt=i(606),ot=i(604),ct=i(605),at=new B.e("IDPlugin"),ut=A.b.create({name:"IDPlugin",addProseMirrorPlugins:function(){this.options;return[new B.d({key:at,props:{handleClickOn:function(t,e,i,n,r,o,c){}}})]}}),st=Z.a((function(t,e,i,n,r){var o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:function(t){return t},u=a.a(o);t((function(t){var o=new Q.d;t.indexdb=new ct.a(e,o),t.provider=new ot.a(i,e,o),t.provider.on("status",(function(e){t.status=e.status}));var a=new l.a(u({editable:r,extensions:[].concat(Object(c.a)(K),[R.a.configure({provider:t.provider,user:n,onUpdate:function(e){return t.users=e,null}}),S.a.configure({document:o})]),onFocus:function(){t.focused=!0},onBlur:function(){t.focused=!1},content:""}));t.editor=a}))})),lt=Z.a((function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",i=arguments.length>2?arguments[2]:void 0,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:function(t){return t},r=a.a(n);t((function(t){var n=new l.a(r({editable:i,extensions:[].concat(Object(c.a)(K),[ut]),onFocus:function(){t.focused=!0},onBlur:function(){t.focused=!1},content:e}));t.editor=n}))})),dt=function(t){return function(){var e=t.editor.state.tr;e.setMeta("preventUpdate",!0),t.editor.view.dispatch(e),t.$emit("update:content",t.editor.getJSON()),t.$emit("update:transaction",e)}};Promise.all([i.e(0),i.e(12)]).then(i.t.bind(null,614,7));var ft={props:{editorObj:"",headings:"",multiple:{type:[Boolean,Object],default:function(){return!1}},content:{type:[String,Object],default:""},editable:{type:[Boolean],default:!0}},computed:{that:function(t){return t},debug:function(){return a.a(console.log)},isMultiple:function(t){return(e=["wsurl","room","user"],tt.a(et.a(0),it.a,nt.a(e),rt.a))(t.multiple);var e},currentUser:function(t){var e,i,n;return{name:(null===(e=t.multiple)||void 0===e?void 0:e.user)||"游客",head:(null===(i=t.multiple)||void 0===i?void 0:i.head)||"",color:(n=["#958DF1","#F98181","#FBBC88","#FAF594","#70CFF8","#94FADB","#B9F18D"],n[Math.floor(Math.random()*n.length)])}},currentRoom:function(t){var e;return(null===(e=t.multiple)||void 0===e?void 0:e.room)||"测试房间"},currentWsUrl:function(t){var e;return(null===(e=t.multiple)||void 0===e?void 0:e.wsurl)||"测试房间"},multipleConfig:function(t){return[function(e){return e(t)}].concat(Object(c.a)(u.a(["currentRoom","currentWsUrl","currentUser","editable","debug"])(t)))},staticConfig:function(t){return[function(e){return e(t)}].concat(Object(c.a)(u.a(["content","editable","debug"])(t)))},createMultiple:function(t){return function(){return st.apply(void 0,Object(c.a)(t.multipleConfig))}},createStatic:function(t){return function(){return lt.apply(void 0,Object(c.a)(t.staticConfig))}},createDocWorkFlow:function(t){var e=t.createMultiple,i=t.createStatic;return s.a((function(t){return t}),e,i)}},mounted:function(){this.createDocWorkFlow(this.isMultiple),this.editor.on("update",dt(this)),this.$nextTick(dt(this))},components:{EditorContent:l.b,MenuBar:p,MarkBar:w},data:function(){var t;return t={focused:!1,editor:null,provider:null,indexdb:null},Object(o.a)(t,"editor",null),Object(o.a)(t,"users",[]),Object(o.a)(t,"status","连接中"),t},methods:{setName:function(){var t=(window.prompt("Name")||"").trim().substring(0,32);if(t)return this.updateCurrentUser({name:t})},updateCurrentUser:function(t){this.currentUser=Object(r.a)(Object(r.a)({},this.currentUser),t),this.editor.chain().focus().user(this.currentUser).run(),localStorage.setItem("currentUser",JSON.stringify(this.currentUser))}},beforeDestroy:function(){this.editor&&this.editor.destroy(),this.provider&&this.provider.destroy()}},vt=(i(596),i(597),Object(f.a)(ft,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"w-p-100 ediotr-container"},[i("div",{staticClass:"flex-al p-20 border-box al-start w-p-100 m-t-100"},[i("div",{staticClass:"w-p-100 fixed-header"},[i("div",{staticClass:"w-p-100 flex-al al-c bg-fff line-b p-10 border-box"},[t.editor&&t.editable?i("MenuBar",{staticClass:"editor__header",attrs:{editor:t.editor}}):t._e()],1),t._v(" "),i("div",{staticClass:"w-p-100 flex-al al-c bg-fff line-b p-10 border-box"},[t.editor&&t.editable?i("MarkBar",{staticClass:"editor__header",attrs:{editor:t.editor}}):t._e()],1)]),t._v(" "),i("div",{staticClass:"doc-a4 m-b-20 m-l-20"},[(t.editor&&t.isMultiple,i("editor-content",{staticClass:"p-b-20",attrs:{editor:t.editor}}))],1)])])}),[],!1,null,"772e2c34",null).exports)}}]);