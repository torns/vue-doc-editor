(window.webpackJsonp=window.webpackJsonp||[]).push([[2],{389:function(t,e,i){},390:function(t,e,i){},391:function(t,e,i){},400:function(t,e,i){},402:function(t,e,i){},403:function(t,e,i){},495:function(t,e,i){"use strict";i(389)},496:function(t,e,i){"use strict";i(390)},497:function(t,e,i){"use strict";i(391)},504:function(t,e){},515:function(t,e,i){"use strict";i(400)},520:function(t,e,i){"use strict";i(402)},521:function(t,e,i){"use strict";i(403)},539:function(t,e,i){"use strict";i.r(e),i.d(e,"DocEditor",(function(){return it})),i.d(e,"Directory",(function(){return rt}));var n=i(349),r=i(388),o=i(41),c=(i(96),i(333),i(545)),a=i(546),u=i(537),s=i(341),d={props:{icon:{type:String,required:!0},title:{type:String,required:!0},action:{type:Function,required:!0},isActive:{type:[Function,Boolean],default:null}}},l=(i(495),i(25)),f={components:{MenuItem:Object(l.a)(d,(function(){var t=this.$createElement,e=this._self._c||t;return e("button",{staticClass:"menu-item",class:{"is-active":this.isActive?this.isActive():null},attrs:{title:this.title},on:{click:this.action}},[e("i",{class:"ri-"+this.icon})])}),[],!1,null,"0ad3b084",null).exports},props:{editor:{type:Object,required:!0}},data:function(){var t=this;return{items:[{icon:"arrow-go-back-line",title:"撤销",action:function(){return t.editor.chain().focus().undo().run()}},{icon:"arrow-go-forward-line",title:"重做",action:function(){return t.editor.chain().focus().redo().run()}},{type:"divider"},{icon:"eye-line",title:"可读",isActive:function(){return t.editor.isActive({read:!0})},action:function(){var e=t.editor.isActive({read:!0});t.editor.chain().focus().setRead(!e).run()}},{icon:"edit-box-line",title:"可写",isActive:function(){return t.editor.isActive({edit:!0})},action:function(){var e=t.editor.isActive({edit:!0});t.editor.chain().focus().setEdit(!e).run()}},{type:"divider"},{icon:"bold",title:"加粗",action:function(){return t.editor.chain().focus().toggleBold().run()},isActive:function(){return t.editor.isActive("bold")}},{icon:"italic",title:"斜体",action:function(){return t.editor.chain().focus().toggleItalic().run()},isActive:function(){return t.editor.isActive("italic")}},{icon:"strikethrough",title:"删除线",action:function(){return t.editor.chain().focus().toggleStrike().run()},isActive:function(){return t.editor.isActive("strike")}},{icon:"code-view",title:"代码块",action:function(){return t.editor.chain().focus().toggleCode().run()},isActive:function(){return t.editor.isActive("code")}},{icon:"mark-pen-line",title:"高亮",action:function(){return t.editor.chain().focus().toggleHighlight().run()},isActive:function(){return t.editor.isActive("highlight")}},{type:"divider"},{icon:"align-left",title:"左对齐",action:function(){return t.editor.chain().focus().setTextAlign("left").run()},isActive:function(){return t.editor.isActive({textAlign:"left"})}},{icon:"align-center",title:"居中",action:function(){return t.editor.chain().focus().setTextAlign("center").run()},isActive:function(){return t.editor.isActive({textAlign:"center"})}},{icon:"align-right",title:"右对齐",action:function(){return t.editor.chain().focus().setTextAlign("right").run()},isActive:function(){return t.editor.isActive({textAlign:"right"})}},{icon:"align-justify",title:"两端对其",action:function(){return t.editor.chain().focus().setTextAlign("justify").run()},isActive:function(){return t.editor.isActive({textAlign:"justify"})}},{type:"divider"},{icon:"h-1",title:"一级标题",action:function(){return t.editor.chain().focus().toggleHeading({level:1}).run()},isActive:function(){return t.editor.isActive("heading",{level:1})}},{icon:"h-2",title:"二级标题",action:function(){return t.editor.chain().focus().toggleHeading({level:2}).run()},isActive:function(){return t.editor.isActive("heading",{level:2})}},{icon:"h-3",title:"三级标题",action:function(){return t.editor.chain().focus().toggleHeading({level:3}).run()},isActive:function(){return t.editor.isActive("heading",{level:3})}},{icon:"h-4",title:"四级标题",action:function(){return t.editor.chain().focus().toggleHeading({level:4}).run()},isActive:function(){return t.editor.isActive("heading",{level:4})}},{icon:"h-5",title:"五级标题",action:function(){return t.editor.chain().focus().toggleHeading({level:5}).run()},isActive:function(){return t.editor.isActive("heading",{level:5})}},{icon:"h-6",title:"六级标题",action:function(){return t.editor.chain().focus().toggleHeading({level:6}).run()},isActive:function(){return t.editor.isActive("heading",{level:6})}},{icon:"paragraph",title:"段落",action:function(){return t.editor.chain().focus().setParagraph().run()},isActive:function(){return t.editor.isActive("paragraph")}},{icon:"list-unordered",title:"无需列表",action:function(){return t.editor.chain().focus().toggleBulletList().run()},isActive:function(){return t.editor.isActive("bulletList")}},{icon:"list-ordered",title:"有序列表",action:function(){return t.editor.chain().focus().toggleOrderedList().run()},isActive:function(){return t.editor.isActive("orderedList")}},{icon:"list-check-2",title:"任务列表",action:function(){return t.editor.chain().focus().toggleTaskList().run()},isActive:function(){return t.editor.isActive("taskList")}},{icon:"code-box-line",title:"代码",action:function(){return t.editor.chain().focus().toggleCodeBlock().run()},isActive:function(){return t.editor.isActive("codeBlock")}},{type:"divider"},{icon:"table-2",title:"表格",action:function(){return t.editor.chain().focus().insertTable({rows:3,cols:3,withHeaderRow:!0}).run()},isActive:!1},{icon:"image-line",title:"图片",action:function(){var e=window.prompt("URL");e&&t.editor.chain().focus().setImage({src:e}).run()},isActive:!1},{icon:"links-fill",title:"A标签",action:function(){if(t.editor.isActive("link"))t.editor.chain().focus().unsetLink().run();else{var e=window.prompt("URL");t.editor.chain().focus().extendMarkRange("link").setLink({href:e}).run()}},isActive:function(){return t.editor.isActive("link")}},{icon:"draft-line",title:"签名",action:function(){t.editor.commands.insertContent('<drawing data-type="drawing"></drawing>')},isActive:!1},{icon:"double-quotes-l",title:"引用",action:function(){return t.editor.chain().focus().toggleBlockquote().run()},isActive:function(){return t.editor.isActive("blockquote")}},{icon:"separator",title:"分割线",action:function(){return t.editor.chain().focus().setHorizontalRule().run()}},{type:"divider"},{icon:"text-wrap",title:"换行",action:function(){return t.editor.chain().focus().setHardBreak().run()}},{icon:"format-clear",title:"清理格式",action:function(){return t.editor.chain().focus().clearNodes().unsetAllMarks().run()}}]}}},h=(i(496),Object(l.a)(f,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",[t._l(t.items,(function(e,n){return["divider"===e.type?i("div",{key:n,staticClass:"divider"}):i("menu-item",t._b({key:n},"menu-item",e,!1))]}))],2)}),[],!1,null,"1d835686",null).exports),v=(i(497),Object(l.a)({},(function(t,e){return(0,e._c)("div",{staticClass:"flex-row flex-wrap al-c p-l-10"})}),[],!0,null,"0ba462e2",null).exports),p=i(527),g=i(318),b=(i(502),i(536)),m=i(540),w=i(524),A=i(551),y=i(547),k=i(530),x=i(525),O=i(313),j=["heading","paragraph","blockquote","listItem","taskItem","codeBlock","image","drawing","horizontalRule","hardBreak","bold"],C=O.b.create({name:"nodeId",defaultOptions:{types:j},addGlobalAttributes:function(){return[{types:j,attributes:{id:{default:null}}}]}}),_=O.c.create({name:"auth",defaultOptions:{HTMLAttributes:{}},addAttributes:function(){return{read:{default:!0,renderHTML:function(t){var e=t.read;return{style:"background:".concat(e?"":"rgba(0,255,0,0.03)")}}},edit:{default:!0,renderHTML:function(t){var e=t.edit;return{contenteditable:e,class:e?"":"no-edit"}}}}},parseHTML:function(){return[{tag:"auth"}]},renderHTML:function(t){var e=t.HTMLAttributes;return["auth",Object(O.m)(this.options.HTMLAttributes,e),0]},addCommands:function(){return{setRead:function(t){return function(e){return e.commands.toggleMark("auth",t)}},setEdit:function(t){return function(e){return e.commands.toggleMark("auth",{edit:t})}}}}}),M=i(523),B=i(528),H=i(505),L=i(506),T=i(507),D=i(508),F=i(406),U=i(509),E=i(510),S=i(407),R=(i(70),i(26),i(511)),q=i(522),z=i(514),$=i.n(z),N={name:"Drawing",components:{NodeViewWrapper:s.c},props:{updateAttributes:{type:Function,required:!0},editor:{type:Object},node:{type:Object,required:!0}},data:function(){return{color:"#000",size:1,svg:null,path:null,points:[],drawing:!1,id:Object(R.v4)()}},methods:{onStartDrawing:function(t){this.drawing=!0,this.points=[],this.path=this.svg.append("path").data([this.points]).attr("id","id-".concat(this.id)).attr("stroke",this.color).attr("stroke-width",this.size);var e="mousedown"===t.type?"mousemove":"touchmove";this.svg.on(e,this.onMove)},onMove:function(t){t.preventDefault(),this.points.push(q.c(t)[0]),this.tick()},onEndDrawing:function(){this.svg.on("mousemove",null),this.svg.on("touchmove",null),this.drawing&&(this.drawing=!1,this.svg.select("#id-".concat(this.id)).remove(),this.id=Object(R.v4)())},simplifyPoints:function(t){return $()(t.map((function(t){return{x:t[0],y:t[1]}}))).map((function(t){return[t.x,t.y]}))},tick:function(){var t=this;requestAnimationFrame((function(){t.path.attr("d",(function(e){var i=q.b().curve(q.a)(e),n=t.node.attrs.lines.filter((function(e){return e.id!==t.id}));return t.updateAttributes({lines:[].concat(Object(o.a)(n),[{id:t.id,color:t.color,size:t.size,path:i}])}),i}))}))},clear:function(){this.updateAttributes({lines:[]})}},computed:{editable:function(t){return t.editor.options.editable},drawBox:function(t){return function(){return t.$refs.drawBox}},isFull:function(t){return function(t){var e;return"fixed"===(null==t||null===(e=t.style)||void 0===e?void 0:e.position)}},full:function(t){return function(t){t.style.position="fixed",t.style.top="0",t.style.left="0",t.style.width="100vw",t.style.height="100vh",t.style.background="#fff",t.style.zIndex="99999"}},disableFull:function(t){return function(t){t.style.position="",t.style.top="",t.style.left="",t.style.width="",t.style.height="",t.style.background="",t.style.zIndex=""}}},mounted:function(){this.svg=q.d(this.$refs.canvas),this.editable&&this.svg.on("mousedown",this.onStartDrawing).on("mouseup",this.onEndDrawing).on("mouseleave",this.onEndDrawing).on("touchstart",this.onStartDrawing).on("touchend",this.onEndDrawing).on("touchleave",this.onEndDrawing)}},I=(i(515),Object(l.a)(N,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("node-view-wrapper",{staticClass:"doc-draw"},[i("div",{ref:"drawBox",class:["draw-box"]},[t.editable?i("div",{staticClass:"doc-draw-set-box"},[i("button",{staticClass:"pionter",on:{click:t.clear}},[t._v("重新签名")]),t._v(" "),i("button",{staticClass:"pionter",on:{click:function(e){t.isFull(t.drawBox())?t.disableFull(t.drawBox()):t.full(t.drawBox())}}},[t._v("切换全屏")])]):t._e(),t._v(" "),i("svg",{ref:"canvas",style:{cursor:t.editable?"crosshair":"pointer"},attrs:{viewBox:"0 0 500 250"}},[t._l(t.node.attrs.lines,(function(e){return[e.id!==t.id?i("path",{key:e.id,attrs:{d:e.path,id:"id-"+e.id,stroke:e.color,"stroke-width":e.size}}):t._e()]}))],2)])])}),[],!1,null,null,null).exports),W=O.d.create({name:"drawing",group:"block",atom:!0,addAttributes:function(){return{lines:{default:[]}}},parseHTML:function(){return[{tag:'drawing[data-type="drawing"]'}]},renderHTML:function(t){var e=t.HTMLAttributes;return["drawing",Object(O.m)(e,{"data-type":"drawing"})]},addNodeView:function(){return Object(s.d)(I)}}),J=i(516),V=i(529),P=i(517),G=i(518),K=i(519),Q=i(526),X=L.a.extend({addAttributes:function(){var t;return Object(n.a)(Object(n.a)({},null===(t=this.parent)||void 0===t?void 0:t.call(this)),{},{backgroundColor:{default:null,parseHTML:function(t){return{backgroundColor:t.getAttribute("data-background-color")}},renderHTML:function(t){return{"data-background-color":t.backgroundColor,style:"background-color: ".concat(t.backgroundColor)}}}})}}),Y=b.a((function(t,e,i,n,r){var o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:function(t){return t},a=c.a(o);t((function(t){var o=new g.d;t.indexdb=new Q.a(e,o),t.provider=new x.a(i,e,o),t.provider.on("status",(function(e){t.status=e.status}));var c=new s.a(a({editable:r,extensions:[M.a,B.a.configure({resizable:!0,allowTableNodeSelection:!0}),W,C,_,J.a,H.a,T.a,D.a,F.a,X,P.a,G.a,S.a,U.a.configure({types:["heading","paragraph"]}),p.a.configure({document:o}),V.a.configure({provider:t.provider,user:n,onUpdate:function(e){return t.users=e,null}}),K.a.configure({limit:1e4}),E.a],content:""}));t.editor=c}))})),Z=b.a((function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",i=arguments.length>2?arguments[2]:void 0,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:function(t){return t},r=c.a(n);t((function(t){var n=new s.a(r({editable:i,extensions:[M.a,B.a.configure({resizable:!0,allowTableNodeSelection:!0}),C,_,W,H.a,T.a,D.a,F.a,X,P.a,G.a,S.a,U.a.configure({types:["heading","paragraph"]}),K.a.configure({limit:1e4}),E.a],content:e}));t.editor=n}))})),tt=function(t){return function(){var e=t.editor.state.tr;e.setMeta("preventUpdate",!0),t.editor.view.dispatch(e),t.$emit("update:content",t.editor.getJSON()),t.$emit("update:transaction",e)}},et={props:{editorObj:"",headings:"",multiple:{type:[Boolean,Object],default:function(){return!1}},content:{type:[String,Object],default:""},editable:{type:[Boolean],default:!0}},computed:{that:function(t){return t},debug:function(){return c.a(console.log)},isMultiple:function(t){return(e=["wsurl","room","user"],m.a(w.a(0),A.a,y.a(e),k.a))(t.multiple);var e},currentUser:function(t){var e,i,n;return{name:(null===(e=t.multiple)||void 0===e?void 0:e.user)||"游客",head:(null===(i=t.multiple)||void 0===i?void 0:i.head)||"",color:(n=["#958DF1","#F98181","#FBBC88","#FAF594","#70CFF8","#94FADB","#B9F18D"],n[Math.floor(Math.random()*n.length)])}},currentRoom:function(t){var e;return(null===(e=t.multiple)||void 0===e?void 0:e.room)||"测试房间"},currentWsUrl:function(t){var e;return(null===(e=t.multiple)||void 0===e?void 0:e.wsurl)||"测试房间"},multipleConfig:function(t){return[function(e){return e(t)}].concat(Object(o.a)(a.a(["currentRoom","currentWsUrl","currentUser","editable","debug"])(t)))},staticConfig:function(t){return[function(e){return e(t)}].concat(Object(o.a)(a.a(["content","editable","debug"])(t)))},createMultiple:function(t){return function(){return Y.apply(void 0,Object(o.a)(t.multipleConfig))}},createStatic:function(t){return function(){return Z.apply(void 0,Object(o.a)(t.staticConfig))}},createDocWorkFlow:function(t){var e=t.createMultiple,i=t.createStatic;return u.a((function(t){return t}),e,i)}},mounted:function(){this.createDocWorkFlow(this.isMultiple),this.editor.on("update",tt(this)),this.$nextTick(tt(this))},components:{EditorContent:s.b,MenuBar:h,AvatarRow:v},data:function(){var t;return t={editor:null,provider:null,indexdb:null},Object(r.a)(t,"editor",null),Object(r.a)(t,"users",[]),Object(r.a)(t,"status","连接中"),t},methods:{setName:function(){var t=(window.prompt("Name")||"").trim().substring(0,32);if(t)return this.updateCurrentUser({name:t})},updateCurrentUser:function(t){this.currentUser=Object(n.a)(Object(n.a)({},this.currentUser),t),this.editor.chain().focus().user(this.currentUser).run(),localStorage.setItem("currentUser",JSON.stringify(this.currentUser))}},beforeDestroy:function(){this.editor&&this.editor.destroy(),this.provider&&this.provider.destroy()}},it=(i(520),i(521),Object(l.a)(et,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"w-p-100 ediotr-container"},[i("div",{staticClass:"flex-al p-20 border-box al-start w-p-100 m-t-100"},[i("div",{staticClass:"w-p-100 fixed-header"},[i("div",{staticClass:"w-p-100 bg-fff border-box line-b p-10 j-sb flex-row al-c"},[t._t("header"),t._v(" "),i("div",{staticClass:"flex-row al-c user-box"},[t.editor&&t.isMultiple&&t.editable?i("AvatarRow",{attrs:{users:t.debug(t.users)}}):t._e(),t._v(" "),t._e()],1)],2),t._v(" "),t._e(),t._v(" "),i("div",{staticClass:"w-p-100 flex-al al-c bg-fff line-b p-10 border-box"},[t.editor&&t.editable?i("MenuBar",{staticClass:"editor__header",attrs:{editor:t.editor}}):t._e()],1)]),t._v(" "),i("div",{staticClass:"doc-a4 m-t-15 m-b-20 m-l-20"},[(t.editor&&t.isMultiple,i("editor-content",{staticClass:"p-b-20",attrs:{editor:t.editor}}))],1)])])}),[],!1,null,"402cbdde",null).exports),nt=(i(72),{props:{content:{type:[String,Object],default:""},editor:""},computed:{that:function(t){return t},debug:function(){return c.a(console.log)}},mounted:function(){this.editor.on("update",this.handleUpdate),this.$nextTick(this.handleUpdate)},data:function(){return{headings:[]}},methods:{handleUpdate:function(){var t=[],e=this.editor.state.tr;this.editor.state.doc.descendants((function(i,r){if("heading"===i.type.name){var o="heading-".concat(t.length+1);i.attrs.id!==o&&e.setNodeMarkup(r,void 0,Object(n.a)(Object(n.a)({},i.attrs),{},{id:o})),t.push({level:i.attrs.level,text:i.textContent,id:o})}})),e.setMeta("preventUpdate",!0),this.editor.view.dispatch(e),this.headings=t}}}),rt=Object(l.a)(nt,(function(){var t=this.$createElement,e=this._self._c||t;return this.editor?e("div",{staticClass:"Directory-container"},[this._v("\n  "+this._s(this.headings)+"\n  ")]):this._e()}),[],!1,null,"767664e7",null).exports;"undefined"!=typeof window&&window.Vue&&install(window.Vue);e.default={install:function(t,e){t.component("DocEditor",it),t.component("Directory",rt)}}}}]);